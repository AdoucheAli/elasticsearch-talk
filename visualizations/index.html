<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF8">
    
    <title>Elasticsearch Visualizations</title>
    <script src="bower_components/jquery/jquery.js"></script>

    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/crossfilter/crossfilter.js"></script>
    <script src="bower_components/d3/d3.js"></script>
    <script src="bower_components/elasticsearch/elasticsearch.js"></script>
    <script src="bower_components/elasticsearch/elasticsearch.angular.js"></script>
    <script src="bower_components/underscore/underscore.js"></script>
    <script>
        var es = new elasticsearch.Client({
            host: 'esdemo.local:9200',
            log: 'trace'
        });

        dimensions = {
            date_of_trip: {
                date_histogram: {
                    field: 'start_time',
                    interval: 'day'
                }
            }
        }

        es.search({
            index: 'divvy',
            body: {
                aggs: {
                    date_of_trip: dimensions.date_of_trip
                },
                size: 0
            }
        }).then(function(resp) {
            var buckets = resp.aggregations.date_of_trip.buckets
            var data = _.map(buckets, function(bucket) {
                return {
                    date: bucket.key_as_string,
                    count: bucket.doc_count
                } 
            });

            ndx = crossfilter(data);
            console.log("ndx", ndx);

            days = ndx.dimension(function(d) {
                return new Date(d.date)
            });
        })
    </script>
</head>
<body>
    <div id="donut-chart"></div>
    <div id="dendrogram"></div>
</body>
</html>
